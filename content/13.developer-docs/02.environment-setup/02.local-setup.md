---
title: "Local Development"
description: "Set up DevStride development on your local machine."
---

# Local Development Setup

This guide walks you through setting up DevStride on your local machine. The project uses **Pulumi** for infrastructure-as-code and the **`ds` CLI** as the central development tool.

## Prerequisites

### 1. Node.js 22+

Install via [nvm](https://github.com/nvm-sh/nvm):

```bash
nvm install 22
nvm alias default 22
```

The repo includes an `.nvmrc` file, so `nvm use` in the project directory will select the correct version automatically.

### 2. pnpm

```bash
npm install -g pnpm
```

### 3. AWS CLI v2

```bash
# macOS
brew install awscli

# Or download from AWS
# https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html
```

### 4. Pulumi CLI

```bash
# macOS
brew install pulumi/tap/pulumi

# Or use the install script
curl -fsSL https://get.pulumi.com | sh
```

After installing, authenticate with Pulumi Cloud:

```bash
pulumi login
```

This requires a Pulumi Cloud account. Request access from a team lead if you do not have one.

### 5. Docker

Install from [docker.com](https://docs.docker.com/engine/install/). Docker is required for running DynamoDB locally during tests.

### 6. AWS SSO Access

You will receive an email invite to `https://devstride.awsapps.com/start`. Accept the invitation before proceeding with setup.

---

## Quick Setup with `ds init`

The fastest way to get started:

```bash
git clone git@github.com:devstride/devstride.git
cd devstride
nvm use
pnpm install
./ds init
```

::callout{type="tip"}
Run `./ds` without arguments to see an interactive menu of all available commands.
::

### What the init wizard does

The wizard walks through 11 steps to configure your local environment:

1. **Check prerequisites** -- verifies Node.js, pnpm, AWS CLI, Pulumi, and git are installed
2. **Check current environment** -- detects any existing configuration
3. **Configure developer name** -- your short, lowercase identifier (e.g., `phil`). This becomes your `DEVSTRIDE_STAGE` and names all your personal cloud resources
4. **Configure AWS SSO profile** -- recommended format: `devstride-yourname`
5. **Choose AWS region** -- select the region closest to you for best performance
6. **Update shell configuration** -- writes environment variables to your `~/.zshrc` or `~/.bashrc`
7. **Set up AWS SSO profile** -- configures the named profile in your AWS config
8. **AWS SSO authentication** -- opens the browser to complete SSO login
9. **Fetch shared secrets to .env** -- pulls shared secrets from AWS Secrets Manager
10. **Auto-provision Neon database branch** -- creates a personal PostgreSQL branch on Neon and adds `DB_CONNECTION_STRING` to your `.env`
11. **Initialize Pulumi stack** -- creates a Pulumi stack named after your developer name and sets config values (`stage`, `region`, `domain`, `tier`)

After init completes, apply the shell changes and run the full automated setup:

```bash
source ~/.zshrc
./ds setup
```

---

## Full Automated Setup with `ds setup`

The `setup` command is the one-command path from a fresh init to a running dev environment:

```bash
./ds setup
```

### Options

| Flag                 | Description                              |
| -------------------- | ---------------------------------------- |
| `--stage <name>`     | Override the stage name (skips prompt)    |
| `--skip-deploy`      | Skip Pulumi infrastructure deployment    |
| `--skip-migrations`  | Skip database migrations                 |
| `--skip-start`       | Skip starting backend and frontend       |

### What it does

The setup orchestrator runs 10 steps:

1. **Pre-flight checks** -- verifies prerequisites and existing configuration. If no environment is configured, it automatically runs `ds init` first
2. **AWS authentication** -- ensures valid AWS SSO credentials
3. **Fetch secrets to .env** -- pulls shared secrets from AWS Secrets Manager (skipped if `.env` already exists)
4. **Neon database provisioning** -- creates a database branch if `DB_CONNECTION_STRING` is not already set
5. **pnpm install** -- installs all dependencies
6. **Pulumi stack initialization** -- creates or selects the Pulumi stack and sets config values
7. **Deploy infrastructure** -- runs `pulumi up` (5-10 minutes on first deploy)
8. **Database migrations** -- generates SQL and runs all pending migrations
9. **Save setup state** -- persists configuration to `~/.devstride/setup-state.json`
10. **Start backend + frontend** -- launches both services (frontend detached, backend in foreground)

---

## Manual Setup

For developers who prefer to configure each piece individually.

### 1. Environment Variables

Add these to your `~/.zshrc` or `~/.bashrc`:

```bash
export DEVSTRIDE_STAGE=yourname         # e.g., phil
export AWS_PROFILE=devstride-yourname
export DEVSTRIDE_DEV_PROFILE=devstride-yourname
export DEVSTRIDE_REGION=us-east-1
```

Then reload your shell:

```bash
source ~/.zshrc
```

### 2. Configure AWS SSO

```bash
aws configure sso
# SSO start URL: https://devstride.awsapps.com/start
# SSO Region: us-east-1
# CLI profile name: devstride-yourname
```

### 3. Pulumi Login

```bash
pulumi login
```

Authenticate with your Pulumi Cloud account. Stacks created with the local backend (`~/.pulumi`) are invisible to CI and other developers, so Pulumi Cloud is required.

### 4. Set Up .env

Fetch shared secrets from AWS Secrets Manager:

```bash
./ds setup-secrets
```

Or copy `.env.sample` to `.env` and ask a team lead for the values.

**Important:** Add your personal `DB_CONNECTION_STRING` from the Neon Console (your branch > Connection Details). You can also provision a Neon branch automatically:

```bash
./ds setup-secrets --neon
```

### 5. Initialize Pulumi Stack

```bash
pulumi stack init yourname -C infra
pulumi config set devstride:stage yourname -s yourname -C infra
pulumi config set devstride:region us-east-1 -s yourname -C infra
pulumi config set devstride:domain devstride.dev -s yourname -C infra
pulumi config set devstride:tier personal -s yourname -C infra
```

### 6. Deploy Infrastructure

```bash
# Using the ds CLI (recommended)
./ds infra run

# Or directly with Pulumi
pulumi up -s yourname -C infra
```

The first deployment takes 5-10 minutes as it provisions all AWS resources (API Gateway, Lambda functions, Cognito, S3, EventBridge, SQS/SNS, CloudFront, and more).

---

## First Run

After infrastructure is deployed:

```bash
# Run database migrations
./ds migrations run

# Set up application configuration
./ds script set-config

# Refresh Pulumi outputs to local env files
./ds outputs

# Start services (use separate terminals)
./ds run backend    # Hono server on http://localhost:3001
./ds run ui         # Vite dev server on http://localhost:8080
```

::callout{type="info"}
The local backend runs in **local dev mode** -- JWT signatures are not verified and membership lookups are skipped. Use the deployed dev environment for auth-sensitive testing.
::

---

## Running Tests

```bash
# Pull the DynamoDB image (first time only)
docker pull amazon/dynamodb-local

# Run all tests
cd backend && pnpm test

# Run a specific test file
cd backend && pnpm test -- tests/suits/path/to/test.spec.ts

# Run tests matching a pattern
cd backend && pnpm test -- -t "test pattern"

# Run with coverage
cd backend && pnpm coverage
```

---

## Daily Workflow

```bash
# Start your day
aws sso login                  # If credentials have expired
./ds run backend               # Start the backend
./ds run ui                    # Start the frontend (separate terminal)

# After pulling changes
pnpm install                   # If dependencies changed
./ds migrations run            # If migrations were added
./ds infra run                 # If infrastructure changed
./ds outputs                   # If stack outputs changed (updates frontend/.env.local)

# Useful commands
./ds outputs                   # Refresh Pulumi stack outputs to local env
./ds -b run backend            # Force-refresh outputs cache, then start backend
./ds setup-secrets             # Re-fetch shared secrets from AWS
./ds help                      # Show all available commands
```

### CLI Flags

Place these **before** the command name:

| Flag | Description                                  |
| ---- | -------------------------------------------- |
| `-b` | Force refresh of Pulumi outputs cache        |
| `-u` | Skip AWS authentication check                |
| `-r` | Target remote environment (not local)        |

---

## Environment Variables

DevStride uses multiple `.env` files:

| File                    | Purpose                                                            |
| ----------------------- | ------------------------------------------------------------------ |
| `.env`                  | Backend and infrastructure secrets (DB, Stripe, Pusher, etc.)      |
| `.env.sample`           | Template for `.env` -- lists all required variables                |
| `frontend/.env.local`   | Frontend `VITE_*` variables (auto-generated by `./ds outputs`)     |
| `frontend/.env.sample`  | Template for frontend variables                                    |

### How variables are managed

- **`./ds setup-secrets`** -- fetches shared secrets from AWS Secrets Manager to `.env`
- **`./ds setup-secrets --push`** -- pushes your local `.env` back to AWS Secrets Manager
- **`./ds outputs`** -- reads deployed Pulumi stack outputs and writes `frontend/.env.local` with values like `VITE_API_ROOT_URL`, `VITE_AWS_COGNITO_CLIENT`, and `VITE_AWS_REGION`

---

## Stripe Setup (Optional)

For developers working on subscription or payment features:

1. Get your test API keys from [dashboard.stripe.com/test/apikeys](https://dashboard.stripe.com/test/apikeys)
2. Add `STRIPE_SECRET_KEY` and `STRIPE_PUBLIC_KEY` to your `.env`
3. Set up a webhook endpoint at [dashboard.stripe.com/test/webhooks](https://dashboard.stripe.com/test/webhooks):
   - Endpoint URL: `https://api-{stage}.devstride.dev/v1/subscriptions/stripe/webhooks`
   - Listen to: Events on your Account
   - Select these events:
     - `customer.subscription.created`
     - `customer.subscription.deleted`
     - `customer.subscription.trial_will_end`
     - `customer.subscription.updated`
4. Add the webhook signing secret as `STRIPE_WEBHOOK_SECRET` in `.env`
5. Seed Stripe products:

```bash
./ds -b stripe add-products
```

---

## Troubleshooting

### AWS Credentials Expired

```bash
aws sso login
```

If you have a named profile:

```bash
aws sso login --profile devstride-yourname
```

### Pulumi Stack Not Found

```bash
# List available stacks
pulumi stack ls -C infra

# Select your stack
pulumi stack select yourname -C infra

# If your stack doesn't exist, create it
pulumi stack init yourname -C infra
```

### Database Connection Issues

1. Verify your Neon branch exists in the [Neon Console](https://console.neon.tech)
2. Check that `.env` has a valid `DB_CONNECTION_STRING`
3. Test the connection by running migrations:

```bash
./ds migrations run
```

### Port Already in Use

The backend runs on port 3001. Kill any existing process:

```bash
lsof -i :3001 | grep LISTEN | awk '{print $2}' | xargs kill -9
```

### "DEVSTRIDE_STAGE and DEVSTRIDE_REGION must be set" Error

Your shell configuration has not been loaded. Either source it manually:

```bash
source ~/.zshrc
```

Or set the variables directly:

```bash
export DEVSTRIDE_STAGE=yourname
export DEVSTRIDE_REGION=us-east-1
```

If the variables are not in your shell config at all, re-run `./ds init` to set them up.

### Pulumi Login Issues

If you see errors about the local backend or stacks not being visible:

```bash
# Check current login status
pulumi whoami

# Log in to Pulumi Cloud (required for team collaboration)
pulumi login
```

### Infrastructure Deployment Fails

```bash
# Preview changes without deploying (useful for debugging)
pulumi preview -s yourname -C infra

# Re-run deployment
pulumi up -s yourname -C infra

# Or use the ds CLI
./ds infra run
```
