---
title: "Data & Scripts"
description: "Commands for database management, data operations, and utility scripts."
---

# Data & Scripts

Commands for managing the database, importing/exporting data, running utility scripts, and Stripe integration.

## Database

### migrations run

Run pending database migrations against your development database.

```bash
./ds migrations run
```

This executes all unapplied Drizzle ORM migrations from the `backend/` migration files against the database specified by `DB_CONNECTION_STRING` in your `.env` file.

### migrations run-sql

Run only the SQL (PostgreSQL) migrations. This is equivalent to `migrations run` in the current codebase since DynamoDB migrations have been removed.

```bash
./ds migrations run-sql
```

### data import

Import data from a dump file into your development database.

```bash
./ds data import <path> [options]
```

**Arguments:**

| Argument | Description |
|----------|-------------|
| `<path>` | Path to the data dump file to import |

**Options:**

| Option | Description |
|--------|-------------|
| `-t, --tables <tables>` | Comma-separated list of table names to import (default: all tables) |

### data export

Export current data from your development database.

```bash
./ds data export [path] [options]
```

Creates a data dump that can later be imported with `data import`. If no path is provided, exports to `.ds/data/<stage>/`.

**Options:**

| Option | Description |
|--------|-------------|
| `-t, --tables <tables>` | Comma-separated list of table names to export (default: all tables) |

### data wipe

Wipe all data from your development database.

```bash
./ds data wipe [options]
```

**Options:**

| Option | Description |
|--------|-------------|
| `-t, --tables <tables>` | Comma-separated list of table names to wipe (default: all tables) |

::callout{type="danger"}
This permanently deletes all data in your development database. There is no undo. Make sure you have an export if you need to preserve anything.
::

### data copy

Copy an organization's data from a source database into your development database, including users, memberships, and all related tables.

```bash
./ds data copy [options]
```

**Options:**

| Option | Description |
|--------|-------------|
| `-o, --organization <id>` | Organization ID to copy (uses a default if not provided) |

This command requires `SOURCE_DB_CONNECTION_STRING` to be set. It removes existing data for the organization in the target database before copying.

::callout{type="warning"}
Cannot be run against the `prod` stage.
::

## Database Schema Changes

When you need to modify the database schema, follow this workflow:

1. **Edit the SQL entity** -- update the associated `*.sql-entity.ts` file in the backend
2. **Generate the migration** -- run the Drizzle Kit migration generator:
   ```bash
   pnpm -C backend generate-sql
   ```
3. **Run the migration** -- apply the generated migration:
   ```bash
   ./ds migrations run
   ```
4. **Restart the backend** -- pick up the schema changes:
   ```bash
   ./ds run backend
   ```

## Scripts

### set-config

Configure application settings in AWS Secrets Manager.

```bash
./ds script set-config
```

Interactive script for viewing and updating configuration values stored in AWS Secrets Manager for your stage.

### reset-db

Reset your development database from a source database.

```bash
export SOURCE_DB_CONNECTION_STRING="<connection-string>"
./ds script reset-db
```

::callout{type="warning"}
You must set `SOURCE_DB_CONNECTION_STRING` before running this command. Contact a team lead if you need access to production database credentials.
::

**Recommended workflow for a clean database reset:**

1. Stash or commit any uncommitted changes (`git status`)
2. Stop the backend (`Ctrl+C` if running)
3. Switch to the latest production code: `git checkout master`
4. Set the source connection string: `export SOURCE_DB_CONNECTION_STRING=<string>`
5. Reset the database: `./ds script reset-db`

### generate-api-client

Generate TypeScript API client types from the backend API definition.

```bash
./ds script generate-api-client
```

This introspects the backend Hono routes and generates typed client interfaces for use in the frontend.

## Stripe

### add-products

Create Stripe products and prices in your development Stripe account.

```bash
./ds -b stripe add-products
```

::callout{type="info"}
The `-b` flag forces a refresh of the Pulumi outputs cache, ensuring the Stripe commands have the latest environment configuration.
::

### create-customers

Create Stripe customers for testing.

```bash
./ds -b stripe create-customers                 # All organizations
./ds -b stripe create-customers -o <org-id>     # Specific organization
```

**Options:**

| Option | Description |
|--------|-------------|
| `-o <org-id>` | Create a customer for a specific organization only |

### find-subscription-quantity

Audit Stripe subscription quantities against actual active user counts. Generates a `subscription_quantity.csv` file showing mismatches.

```bash
./ds -b stripe find-subscription-quantity                 # All organizations
./ds -b stripe find-subscription-quantity -o <org-id>     # Specific organization
```

**Options:**

| Option | Description |
|--------|-------------|
| `-o <org-id>` | Check a specific organization only |
