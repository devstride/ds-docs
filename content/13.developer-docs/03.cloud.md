---
title: "ds cloud"
description: "Commands for infrastructure deployment, secrets, stages, Stripe, and administration."
---

# ds cloud

Infrastructure, secrets, stage lifecycle, and cloud integrations. All commands require AWS authentication.

---

## Deploy & Destroy

### cloud deploy

**Purpose:** Deploy infrastructure with Pulumi (`pulumi up --yes --skip-preview`).

**When to use:** After changing `infra/` code, when setting up a new stage, or after pulling infrastructure changes.

::callout{type="info"}
First deploy creates ~800 resources (10-15 min). Subsequent deploys are incremental (1-3 min).
::

---

### cloud destroy

**Purpose:** Tear down all infrastructure for a stage and clean up associated resources.

**When to use:** When a personal stage is no longer needed.

| Option | Description |
|--------|-------------|
| `--keep-stack` | Keep Pulumi stack state |
| `--delete-neon` | Also delete the Neon database branch |
| `--dry-run` | Preview only |

Requires typing stage name to confirm. Blocked on protected stages.

::callout{type="danger"}
Permanently destroys all AWS resources. Use `--dry-run` first.
::

---

## Stage Management

### cloud stage list

**Purpose:** List all deployed Pulumi stages with status, resource counts, and timestamps.

**When to use:** To check which stages are deployed or verify your own stage status.

| Option | Description |
|--------|-------------|
| `--stage <name>` | Show one stage only |
| `--region <region>` | Filter by region |
| `--json` | JSON output |

---

### cloud stage pause

**Purpose:** Set Lambda concurrency to 0 on all functions for your stage, blocking all invocations.

**When to use:** End of work day or extended breaks to save AWS costs.

::callout{type="info"}
Only personal stages can be paused. Protected stages are blocked.
::

---

### cloud stage resume

**Purpose:** Remove concurrency limit, restoring all Lambda functions to accept invocations.

**When to use:** Start of work day after a pause.

---

### cloud stage prune

**Purpose:** Discover and destroy orphaned personal stages across all AWS regions.

**When to use:** Periodic cleanup of stale developer stages. Typically run by a team lead.

| Option | Description |
|--------|-------------|
| `--region <regions>` | Comma-separated regions (default: all) |
| `--stale-days <days>` | Staleness threshold (default: 14) |
| `--dry-run` | Preview only |
| `--include-neon` | Also delete Neon branches |
| `--stages <stages>` | Target specific stages |
| `--force` | Skip confirmation |

::callout{type="warning"}
Always `--dry-run` first.
::

---

### cloud stage teardown

**Purpose:** Tear down a preview/CI environment.

**When to use:** Automatically invoked by CI/CD pipelines. Not typically run manually.

---

## Secrets & Configuration

### cloud secrets pull

**Purpose:** Pull secrets from AWS Secrets Manager to `.env`.

**When to use:** First-time setup, after secret rotation, or when `.env` is missing.

| Option | Description |
|--------|-------------|
| `--neon` | Also provision a Neon database branch |

---

### cloud secrets push

**Purpose:** Push local `.env` to AWS Secrets Manager.

**When to use:** After adding new environment variables that other developers need.

::callout{type="warning"}
Overwrites the shared secret. Coordinate with your team.
::

---

### cloud outputs pull

**Purpose:** Fetch Pulumi stack outputs and write `frontend/.env.local` and `.ds/bind/` cache.

**When to use:** After deploying infrastructure. Restart backend and frontend afterward.

| Option | Description |
|--------|-------------|
| `--stage <name>` | Override stage |
| `--no-frontend` | Skip `frontend/.env.local` |
| `--no-backend` | Skip backend bind cache |

---

### cloud config sync

**Purpose:** Push runtime application configuration (feature flags, limits, integration settings) to Secrets Manager.

**When to use:** After changing app config that is stored in Secrets Manager rather than code.

::callout{type="info"}
Changes take effect on the next Lambda cold start. Redeploy for immediate effect.
::

---

## Cloud Database

### cloud db reset

**Purpose:** Reset the target database from a source database (typically production).

**When to use:** When development data has diverged too far from production or to reproduce a production issue.

::callout{type="warning"}
Requires `SOURCE_DB_CONNECTION_STRING` environment variable. Contact a team lead for credentials.
::

---

### cloud db seed

**Purpose:** Seed the database and Cognito user pool with test organizations, users, and sample data.

**When to use:** After deploying a new stage or after a complete data wipe.

| Option | Description |
|--------|-------------|
| `--cognito` | Seed Cognito users only (skip database seed) |

::callout{type="info"}
`--cognito` is useful when database data exists but Cognito users need recreating (e.g., after recreating the user pool).
::

---

## Data Operations

### cloud data clone-org

**Purpose:** Copy one organization's complete data (users, items, boards, memberships) from a source database and create corresponding Cognito users.

**When to use:** When you need realistic data from a specific organization.

| Option | Description |
|--------|-------------|
| `-o, --organization <id>` | Organization ID (uses default if omitted) |

::callout{type="warning"}
Requires `SOURCE_DB_CONNECTION_STRING`. This touches both the database and Cognito, which is why it is under `cloud` rather than `db`.
::

---

## Maintenance

### cloud maintenance on

**Purpose:** Enable maintenance mode (API returns 503, frontend shows maintenance page).

**When to use:** Before migrations or operations that could cause data inconsistency while users are active.

---

### cloud maintenance off

**Purpose:** Disable maintenance mode, restoring normal operation.

---

## Stripe

### cloud stripe sync-products

**Purpose:** Create or update Stripe products and prices from the codebase product catalog.

**When to use:** When setting up a new stage or after modifying product definitions.

::callout{type="info"}
Run `ds cloud outputs pull` first if you need to refresh cached Pulumi outputs (e.g., after updating Stripe API keys in infrastructure).
::

---

### cloud stripe sync-customers

**Purpose:** Create Stripe customer records for organizations that do not have one.

**When to use:** After seeding or when new organizations lack Stripe customers.

| Option | Description |
|--------|-------------|
| `-o, --organization <id>` | Single organization only |

---

### cloud stripe check-quantities

**Purpose:** Compare Stripe subscription quantities against actual active user counts and report mismatches.

**When to use:** Billing reconciliation or when a customer reports incorrect billing.

| Option | Description |
|--------|-------------|
| `-o, --organization <id>` | Single organization only |

---

## Admin

### cloud audit

**Purpose:** Scan AWS across all regions for deployed DevStride resources (Lambda, API Gateway, DynamoDB, S3, SQS, SNS, EventBridge, Step Functions, Cognito, etc.).

**When to use:** Cost auditing, finding orphaned resources not tracked by Pulumi, or getting a full inventory.

| Option | Description |
|--------|-------------|
| `--region <region>` | Scan one region (default: all) |
| `--json` | JSON output |
| `--verbose` | Show individual resource names |

::callout{type="info"}
Full multi-region scans take several minutes. Use `--region us-east-1` for faster results.
::

---

### cloud slack setup-workflows

**Purpose:** Create Slack workflow automations for users who have connected Slack but do not yet have workflows.

**When to use:** After enabling Slack integration for an organization, or when users report missing Slack notifications.
